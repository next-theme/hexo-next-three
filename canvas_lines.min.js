THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",THREE.REVISION),e=e||{};var s,l,c,p,E,d,h,f,u,m,v,x,R,y,T,w,H,g,S,M=this,b=new THREE.Projector,r=void 0!==e.canvas?e.canvas:document.createElement("canvas"),C=r.width,z=r.height,V=Math.floor(C/2),j=Math.floor(z/2),L=0,O=0,B=C,W=z,n=1,P=r.getContext("2d",{alpha:!0===e.alpha}),i=new THREE.Color(0),o=!0===e.alpha?0:1,a=1,k=0,N=null,F=null,A=null,I=null,D=null,t=[],G=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),U=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),q=new THREE.Color,X=new THREE.Color,J={},Y=new THREE.Box2,K=new THREE.Box2,Q=new THREE.Box2,Z=new THREE.Color,$=new THREE.Color,_=new THREE.Color,ee=new THREE.Vector3,te=new THREE.Vector3,ie=new THREE.Vector3,re=new THREE.Matrix3;function ne(e,t,i,r){Ee(t),de(i),he(r),fe(e.getStyle()),P.stroke(),Q.expandByScalar(2*t)}function oe(e){ue(e.getStyle()),P.fill()}function ae(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var t=e.image;if(!1===t.complete)return{canvas:void 0,version:0};var i=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,r=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,n=e.wrapS===THREE.MirroredRepeatWrapping,o=e.wrapT===THREE.MirroredRepeatWrapping,a=document.createElement("canvas");a.width=t.width*(n?2:1),a.height=t.height*(o?2:1);var s=a.getContext("2d");s.setTransform(1,0,0,-1,0,t.height),s.drawImage(t,0,0),!0==n&&(s.setTransform(-1,0,0,-1,t.width,t.height),s.drawImage(t,-t.width,0)),!0==o&&(s.setTransform(1,0,0,1,0,0),s.drawImage(t,0,t.height)),!0==n&&!0==o&&(s.setTransform(-1,0,0,1,t.width,0),s.drawImage(t,-t.width,t.height));var l="no-repeat";!0==i&&!0==r?l="repeat":!0==i?l="repeat-x":!0==r&&(l="repeat-y");var c=P.createPattern(a,l);return e.onUpdate&&e.onUpdate(e),{canvas:c,version:e.version}}function se(e,t,i,r,n,o,a,s,l,c,p,E,d){var h=J[d.id];if(void 0!==h&&h.version===d.version||(h=ae(d),J[d.id]=h),void 0===h.canvas)return ue("rgba( 0, 0, 0, 1)"),void P.fill();ue(h.canvas);var f,u,m,v,x,R,y,T,w=d.offset.x/d.repeat.x,H=d.offset.y/d.repeat.y,g=d.image.width*d.repeat.x,S=d.image.height*d.repeat.y;l=(l+w)*g,c=(c+H)*S,p=(p+w)*g,E=(E+H)*S,i-=e,r-=t,n-=e,o-=t,0!=(y=(l-=a=(a+w)*g)*(E-=s=(s+H)*S)-(p-=a)*(c-=s))&&(x=e-(f=(E*i-c*n)*(T=1/y))*a-(m=(l*n-p*i)*T)*s,R=t-(u=(E*r-c*o)*T)*a-(v=(l*o-p*r)*T)*s,P.save(),P.transform(f,u,m,v,x,R),P.fill(),P.restore())}function le(e,t,i){var r,n=t.x-e.x,o=t.y-e.y,a=n*n+o*o;0!=a&&(n*=r=i/Math.sqrt(a),o*=r,t.x+=n,t.y+=o,e.x-=n,e.y-=o)}function ce(e){a!==e&&(P.globalAlpha=e,a=e)}function pe(e){k!==e&&(e===THREE.NormalBlending?P.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?P.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?P.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(P.globalCompositeOperation="multiply"),k=e)}function Ee(e){A!==e&&(P.lineWidth=e,A=e)}function de(e){I!==e&&(P.lineCap=e,I=e)}function he(e){D!==e&&(P.lineJoin=e,D=e)}function fe(e){N!==e&&(P.strokeStyle=e,N=e)}function ue(e){F!==e&&(P.fillStyle=e,F=e)}function me(e){t.length!==e.length&&(P.setLineDash(e),t=e)}void 0===P.setLineDash&&(P.setLineDash=function(){}),this.domElement=r,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return P},this.getContextAttributes=function(){return P.getContextAttributes()},this.getPixelRatio=function(){return n},this.setPixelRatio=function(e){void 0!==e&&(n=e)},this.setSize=function(e,t,i){C=e*n,z=t*n,r.width=C,r.height=z,V=Math.floor(C/2),j=Math.floor(z/2),!1!==i&&(r.style.width=e+"px",r.style.height=t+"px"),Y.min.set(-V,-j),Y.max.set(V,j),K.min.set(-V,-j),K.max.set(V,j),a=1,k=0,D=I=A=F=N=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,r){L=e*n,O=t*n,B=i*n,W=r*n},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,t){i.set(e),o=void 0!==t?t:1,K.min.set(-V,-j),K.max.set(V,j)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return i},this.getClearAlpha=function(){return o},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===K.isEmpty()&&(K.intersect(Y),K.expandByScalar(2),K.min.x=K.min.x+V,K.min.y=-K.min.y+j,K.max.x=K.max.x+V,K.max.y=-K.max.y+j,o<1&&P.clearRect(0|K.min.x,0|K.max.y,K.max.x-K.min.x|0,K.min.y-K.max.y|0),0<o&&(pe(THREE.NormalBlending),ce(1),ue("rgba("+Math.floor(255*i.r)+","+Math.floor(255*i.g)+","+Math.floor(255*i.b)+","+o+")"),P.fillRect(0|K.min.x,0|K.max.y,K.max.x-K.min.x|0,K.min.y-K.max.y|0)),K.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,t){if(t instanceof THREE.Camera!=!1){var i=e.background;i&&i.isColor?(ue("rgb("+Math.floor(255*i.r)+","+Math.floor(255*i.g)+","+Math.floor(255*i.b)+")"),P.fillRect(0,0,C,z)):!0===this.autoClear&&this.clear(),M.info.render.vertices=0,M.info.render.faces=0,P.setTransform(B/C,0,0,-W/z,L,z-O),P.translate(V,j),s=b.projectScene(e,t,this.sortObjects,this.sortElements),l=s.elements,c=s.lights,re.getNormalMatrix(t.matrixWorldInverse),function(){Z.setRGB(0,0,0),$.setRGB(0,0,0),_.setRGB(0,0,0);for(var e=0,t=c.length;e<t;e++){var i=c[e],r=i.color;i instanceof THREE.AmbientLight?Z.add(r):i instanceof THREE.DirectionalLight?$.add(r):i instanceof THREE.PointLight&&_.add(r)}}();for(var r=0,n=l.length;r<n;r++){var o=l[r],a=o.material;if(void 0!==a&&0!==a.opacity){if(Q.makeEmpty(),o instanceof THREE.RenderableSprite)(p=o).x*=V,p.y*=j,function(e,t,i){ce(i.opacity),pe(i.blending);var r=t.scale.x*V,n=t.scale.y*j,o=.5*Math.sqrt(r*r+n*n);{var a,s,l,c,p,E,d,h,f;Q.min.set(e.x-o,e.y-o),Q.max.set(e.x+o,e.y+o),i instanceof THREE.SpriteMaterial?null!==(a=i.map)?(void 0!==(s=J[a.id])&&s.version===a.version||(s=ae(a),J[a.id]=s),void 0!==s.canvas&&(ue(s.canvas),l=a.image,c=l.width*a.offset.x,p=l.height*a.offset.y,E=l.width*a.repeat.x,d=l.height*a.repeat.y,h=r/E,f=n/d,P.save(),P.translate(e.x,e.y),0!==i.rotation&&P.rotate(i.rotation),P.translate(-r/2,-n/2),P.scale(h,f),P.translate(-c,-p),P.fillRect(c,p,E,d),P.restore())):(ue(i.color.getStyle()),P.save(),P.translate(e.x,e.y),0!==i.rotation&&P.rotate(i.rotation),P.scale(r,-n),P.fillRect(-.5,-.5,1,1),P.restore()):i instanceof THREE.SpriteCanvasMaterial&&(fe(i.color.getStyle()),ue(i.color.getStyle()),P.save(),P.translate(e.x,e.y),0!==i.rotation&&P.rotate(i.rotation),P.scale(r,n),i.program(P),P.restore())}}(p,o,a);else if(o instanceof THREE.RenderableLine)p=o.v1,E=o.v2,p.positionScreen.x*=V,p.positionScreen.y*=j,E.positionScreen.x*=V,E.positionScreen.y*=j,Q.setFromPoints([p.positionScreen,E.positionScreen]),!0===Y.intersectsBox(Q)&&function(e,t,i,r){if(ce(r.opacity),pe(r.blending),P.beginPath(),P.moveTo(e.positionScreen.x,e.positionScreen.y),P.lineTo(t.positionScreen.x,t.positionScreen.y),r instanceof THREE.LineBasicMaterial){if(Ee(r.linewidth),de(r.linecap),he(r.linejoin),r.vertexColors!==THREE.VertexColors)fe(r.color.getStyle());else{var n=i.vertexColors[0].getStyle(),o=i.vertexColors[1].getStyle();if(n===o)fe(n);else{try{var a=P.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,n),a.addColorStop(1,o)}catch(e){a=n}fe(a)}}P.stroke(),Q.expandByScalar(2*r.linewidth)}else r instanceof THREE.LineDashedMaterial&&(Ee(r.linewidth),de(r.linecap),he(r.linejoin),fe(r.color.getStyle()),me([r.dashSize,r.gapSize]),P.stroke(),Q.expandByScalar(2*r.linewidth),me([]))}(p,E,o,a);else if(o instanceof THREE.RenderableFace){if(p=o.v1,E=o.v2,d=o.v3,p.positionScreen.z<-1||1<p.positionScreen.z)continue;if(E.positionScreen.z<-1||1<E.positionScreen.z)continue;if(d.positionScreen.z<-1||1<d.positionScreen.z)continue;p.positionScreen.x*=V,p.positionScreen.y*=j,E.positionScreen.x*=V,E.positionScreen.y*=j,d.positionScreen.x*=V,d.positionScreen.y*=j,0<a.overdraw&&(le(p.positionScreen,E.positionScreen,a.overdraw),le(E.positionScreen,d.positionScreen,a.overdraw),le(d.positionScreen,p.positionScreen,a.overdraw)),Q.setFromPoints([p.positionScreen,E.positionScreen,d.positionScreen]),!0===Y.intersectsBox(Q)&&function(e,t,i,r,n,o,a,s){{M.info.render.vertices+=3,M.info.render.faces++,ce(s.opacity),pe(s.blending),h=e.positionScreen.x,f=e.positionScreen.y,u=t.positionScreen.x,m=t.positionScreen.y,v=i.positionScreen.x,x=i.positionScreen.y,function(e,t,i,r,n,o){P.beginPath(),P.moveTo(e,t),P.lineTo(i,r),P.lineTo(n,o),P.closePath()}(h,f,u,m,v,x),(s instanceof THREE.MeshLambertMaterial||s instanceof THREE.MeshPhongMaterial)&&null===s.map?(U.copy(s.color),q.copy(s.emissive),s.vertexColors===THREE.FaceColors&&U.multiply(a.color),G.copy(Z),te.copy(e.positionWorld).add(t.positionWorld).add(i.positionWorld).divideScalar(3),function(e,t,i){for(var r=0,n=c.length;r<n;r++){var o=c[r];if(X.copy(o.color),o instanceof THREE.DirectionalLight){var a=ee.setFromMatrixPosition(o.matrixWorld).normalize();if((s=t.dot(a))<=0)continue;s*=o.intensity,i.add(X.multiplyScalar(s))}else if(o instanceof THREE.PointLight){var s,a=ee.setFromMatrixPosition(o.matrixWorld);if((s=t.dot(ee.subVectors(a,e).normalize()))<=0)continue;if(0==(s*=0==o.distance?1:1-Math.min(e.distanceTo(a)/o.distance,1)))continue;s*=o.intensity,i.add(X.multiplyScalar(s))}}}(te,a.normalModel,G),G.multiply(U).add(q),!0===s.wireframe?ne(G,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):oe(G)):s instanceof THREE.MeshBasicMaterial||s instanceof THREE.MeshLambertMaterial||s instanceof THREE.MeshPhongMaterial?null!==s.map?s.map.mapping===THREE.UVMapping&&(R=a.uvs,se(h,f,u,m,v,x,R[r].x,R[r].y,R[n].x,R[n].y,R[o].x,R[o].y,s.map)):null!==s.envMap?s.envMap.mapping===THREE.SphericalReflectionMapping&&(ie.copy(a.vertexNormalsModel[r]).applyMatrix3(re),y=.5*ie.x+.5,T=.5*ie.y+.5,ie.copy(a.vertexNormalsModel[n]).applyMatrix3(re),w=.5*ie.x+.5,H=.5*ie.y+.5,ie.copy(a.vertexNormalsModel[o]).applyMatrix3(re),g=.5*ie.x+.5,S=.5*ie.y+.5,se(h,f,u,m,v,x,y,T,w,H,g,S,s.envMap)):(G.copy(s.color),s.vertexColors===THREE.FaceColors&&G.multiply(a.color),!0===s.wireframe?ne(G,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):oe(G)):(s instanceof THREE.MeshNormalMaterial?(ie.copy(a.normalModel).applyMatrix3(re),G.setRGB(ie.x,ie.y,ie.z).multiplyScalar(.5).addScalar(.5)):G.setRGB(1,1,1),!0===s.wireframe?ne(G,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):oe(G))}}(p,E,d,0,1,2,o,a)}K.union(Q)}}P.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.")}},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){var ne,oe,n,ae,se,le,ce,pe,Ee,de,he,fe=[],ue=0,me=[],t=0,i=[],r=0,o=[],a=0,ve=[],xe=0,Re={objects:[],lights:[],elements:[]},ye=new THREE.Vector3,Te=new THREE.Vector4,s=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),u=new THREE.Box3,m=new Array(3),we=(new Array(4),new THREE.Matrix4),He=new THREE.Matrix4,ge=new THREE.Matrix4,Se=new THREE.Matrix3,Me=new THREE.Frustum,be=new THREE.Vector4,Ce=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var ze=new function(){var l=[],c=[],p=null,E=null,d=new THREE.Matrix3;function r(e){var t=e.position,i=e.positionWorld,r=e.positionScreen;i.copy(t).applyMatrix4(he),r.copy(i).applyMatrix4(He);var n=1/r.w;r.x*=n,r.y*=n,r.z*=n,e.visible=-1<=r.x&&r.x<=1&&-1<=r.y&&r.y<=1&&-1<=r.z&&r.z<=1}function h(e,t,i){return!0===e.visible||!0===t.visible||!0===i.visible||(m[0]=e.positionScreen,m[1]=t.positionScreen,m[2]=i.positionScreen,s.intersectsBox(u.setFromPoints(m)))}function f(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(e){E=(p=e).material,d.getNormalMatrix(p.matrixWorld),l.length=0,c.length=0},projectVertex:r,checkTriangleVisibility:h,checkBackfaceCulling:f,pushVertex:function(e,t,i){(n=Ve()).position.set(e,t,i),r(n)},pushNormal:function(e,t,i){l.push(e,t,i)},pushUv:function(e,t){c.push(e,t)},pushLine:function(e,t){var i=me[e],r=me[t];(ce=Le()).id=p.id,ce.v1.copy(i),ce.v2.copy(r),ce.z=(i.positionScreen.z+r.positionScreen.z)/2,ce.renderOrder=p.renderOrder,ce.material=p.material,Re.elements.push(ce)},pushTriangle:function(e,t,i){var r=me[e],n=me[t],o=me[i];if(!1!==h(r,n,o)&&(E.side===THREE.DoubleSide||!0===f(r,n,o))){(se=je()).id=p.id,se.v1.copy(r),se.v2.copy(n),se.v3.copy(o),se.z=(r.positionScreen.z+n.positionScreen.z+o.positionScreen.z)/3,se.renderOrder=p.renderOrder,se.normalModel.fromArray(l,3*e),se.normalModel.applyMatrix3(d).normalize();for(var a=0;a<3;a++){var s=se.vertexNormalsModel[a];s.fromArray(l,3*arguments[a]),s.applyMatrix3(d).normalize(),se.uvs[a].fromArray(c,2*arguments[a])}se.vertexNormalsLength=3,se.material=p.material,Re.elements.push(se)}}}};function Ve(){if(ae!==t)return me[ae++];var e=new THREE.RenderableVertex;return me.push(e),t++,ae++,e}function je(){if(le!==r)return i[le++];var e=new THREE.RenderableFace;return i.push(e),r++,le++,e}function Le(){if(pe!==a)return o[pe++];var e=new THREE.RenderableLine;return o.push(e),a++,pe++,e}function Oe(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(e,t,i,r){function n(e){(ne=function(){if(oe!==ue)return fe[oe++];var e=new THREE.RenderableObject;return fe.push(e),ue++,oe++,e}()).id=e.id,ne.object=e,ye.setFromMatrixPosition(e.matrixWorld),ye.applyMatrix4(He),ne.z=ye.z,ne.renderOrder=e.renderOrder,Re.objects.push(ne)}de=pe=le=0,!(Re.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),we.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),He.multiplyMatrices(t.projectionMatrix,we),Me.setFromMatrix(He),oe=0,Re.objects.length=0,Re.lights.length=0,e.traverseVisible(function(e){if(e instanceof THREE.Light)Re.lights.push(e);else if(e instanceof THREE.Mesh||e instanceof THREE.Line){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===Me.intersectsObject(e))return;n(e)}else if(e instanceof THREE.Sprite){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===Me.intersectsSprite(e))return;n(e)}}),!0===i&&Re.objects.sort(Oe);for(var o,a,s,l,c,p,E,d,h=0,f=Re.objects.length;h<f;h++){var u,m=Re.objects[h].object,v=m.geometry;if(ze.setObject(m),he=m.matrixWorld,ae=0,m instanceof THREE.Mesh){if(v instanceof THREE.BufferGeometry){var x=v.attributes,R=v.groups;if(void 0===x.position)continue;for(var y=0,T=(ie=x.position.array).length;y<T;y+=3)ze.pushVertex(ie[y],ie[y+1],ie[y+2]);if(void 0!==x.normal)for(var w=x.normal.array,y=0,T=w.length;y<T;y+=3)ze.pushNormal(w[y],w[y+1],w[y+2]);if(void 0!==x.uv)for(var H=x.uv.array,y=0,T=H.length;y<T;y+=2)ze.pushUv(H[y],H[y+1]);if(null!==v.index){var g=v.index.array;if(0<R.length)for(var S=0;S<R.length;S++)for(var M=R[S],y=M.start,T=M.start+M.count;y<T;y+=3)ze.pushTriangle(g[y],g[y+1],g[y+2]);else for(y=0,T=g.length;y<T;y+=3)ze.pushTriangle(g[y],g[y+1],g[y+2])}else for(y=0,T=ie.length/3;y<T;y+=3)ze.pushTriangle(y,y+1,y+2)}else if(v instanceof THREE.Geometry){var b=v.vertices,C=v.faces,z=v.faceVertexUvs[0];Se.getNormalMatrix(he);for(var V=(G=m.material)instanceof THREE.MultiMaterial,j=!0==V?m.material:null,L=0,O=b.length;L<O;L++){var B=b[L];if(ye.copy(B),!0===G.morphTargets)for(var W=v.morphTargets,P=m.morphTargetInfluences,k=0,N=W.length;k<N;k++){var F,A=P[k];0!==A&&(F=W[k].vertices[L],ye.x+=(F.x-B.x)*A,ye.y+=(F.y-B.y)*A,ye.z+=(F.z-B.z)*A)}ze.pushVertex(ye.x,ye.y,ye.z)}for(var I=0,D=C.length;I<D;I++){var G,U=C[I];if(void 0!==(G=!0==V?j.materials[U.materialIndex]:m.material)){var q=G.side,X=me[U.a],J=me[U.b],Y=me[U.c];if(!1!==ze.checkTriangleVisibility(X,J,Y)){var K=ze.checkBackfaceCulling(X,J,Y);if(q!==THREE.DoubleSide){if(q===THREE.FrontSide&&!1===K)continue;if(q===THREE.BackSide&&!0===K)continue}(se=je()).id=m.id,se.v1.copy(X),se.v2.copy(J),se.v3.copy(Y),se.normalModel.copy(U.normal),!1!==K||q!==THREE.BackSide&&q!==THREE.DoubleSide||se.normalModel.negate(),se.normalModel.applyMatrix3(Se).normalize();for(var Q=U.vertexNormals,Z=0,$=Math.min(Q.length,3);Z<$;Z++){var _=se.vertexNormalsModel[Z];_.copy(Q[Z]),!1!==K||q!==THREE.BackSide&&q!==THREE.DoubleSide||_.negate(),_.applyMatrix3(Se).normalize()}se.vertexNormalsLength=Q.length;var ee=z[I];if(void 0!==ee)for(var te=0;te<3;te++)se.uvs[te].copy(ee[te]);se.color=U.color,se.material=G,se.z=(X.positionScreen.z+J.positionScreen.z+Y.positionScreen.z)/3,se.renderOrder=m.renderOrder,Re.elements.push(se)}}}}}else if(m instanceof THREE.Line){if(v instanceof THREE.BufferGeometry){if(void 0!==(x=v.attributes).position){for(var ie,y=0,T=(ie=x.position.array).length;y<T;y+=3)ze.pushVertex(ie[y],ie[y+1],ie[y+2]);if(null!==v.index)for(y=0,T=(g=v.index.array).length;y<T;y+=2)ze.pushLine(g[y],g[y+1]);else for(var re=m instanceof THREE.LineSegments?2:1,y=0,T=ie.length/3-1;y<T;y+=re)ze.pushLine(y,y+1)}}else if(v instanceof THREE.Geometry){if(ge.multiplyMatrices(He,he),0===(b=m.geometry.vertices).length)continue;(X=Ve()).positionScreen.copy(b[0]).applyMatrix4(ge);for(re=m instanceof THREE.LineSegments?2:1,L=1,O=b.length;L<O;L++)(X=Ve()).positionScreen.copy(b[L]).applyMatrix4(ge),0<(L+1)%re||(J=me[ae-2],be.copy(X.positionScreen),Ce.copy(J.positionScreen),!0==(a=Ce,d=E=p=c=l=s=void 0,s=0,l=1,c=(o=be).z+o.w,p=a.z+a.w,E=-o.z+o.w,d=-a.z+a.w,0<=c&&0<=p&&0<=E&&0<=d||!(c<0&&p<0||E<0&&d<0)&&(c<0?s=Math.max(s,c/(c-p)):p<0&&(l=Math.min(l,c/(c-p))),E<0?s=Math.max(s,E/(E-d)):d<0&&(l=Math.min(l,E/(E-d))),!(l<s||(o.lerp(a,s),a.lerp(o,1-l),0))))&&(be.multiplyScalar(1/be.w),Ce.multiplyScalar(1/Ce.w),(ce=Le()).id=m.id,ce.v1.positionScreen.copy(be),ce.v2.positionScreen.copy(Ce),ce.z=Math.max(be.z,Ce.z),ce.renderOrder=m.renderOrder,ce.material=m.material,m.material.vertexColors===THREE.VertexColors&&(ce.vertexColors[0].copy(m.geometry.colors[L]),ce.vertexColors[1].copy(m.geometry.colors[L-1])),Re.elements.push(ce)))}}else{m instanceof THREE.Sprite&&(Te.set(he.elements[12],he.elements[13],he.elements[14],1),Te.applyMatrix4(He),u=1/Te.w,Te.z*=u,-1<=Te.z&&Te.z<=1&&((Ee=function(){if(de!==xe)return ve[de++];var e=new THREE.RenderableSprite;return ve.push(e),xe++,de++,e}()).id=m.id,Ee.x=Te.x*u,Ee.y=Te.y*u,Ee.z=Te.z,Ee.renderOrder=m.renderOrder,Ee.object=m,Ee.rotation=m.rotation,Ee.scale.x=m.scale.x*Math.abs(Ee.x-(Te.x+t.projectionMatrix.elements[0])/(Te.w+t.projectionMatrix.elements[12])),Ee.scale.y=m.scale.y*Math.abs(Ee.y-(Te.y+t.projectionMatrix.elements[5])/(Te.w+t.projectionMatrix.elements[13])),Ee.material=m.material,Re.elements.push(Ee)))}}return!0===r&&Re.elements.sort(Oe),Re}},function(){var s,l,c,t=0,i=0,r=window.innerWidth/2,n=window.innerHeight/2;function p(){r=window.innerWidth/2,n=window.innerHeight/2,s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),c.setSize(window.innerWidth,window.innerHeight)}function E(e){t=e.clientX-r,i=e.clientY-n}function d(e){1<e.touches.length&&(t=e.touches[0].pageX-r)}function h(e){1==e.touches.length&&(t=e.touches[0].pageX-r)}function o(){s.position.x+=.05*(t-s.position.x),s.position.y+=.05*(200-i-s.position.y),s.lookAt(l.position),c.render(l,s)}!function(){var e,t;(e=document.createElement("div")).style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.zIndex="-1",e.style.opacity="0.5",document.body.appendChild(e),(s=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e4)).position.z=100,l=new THREE.Scene,(c=new THREE.CanvasRenderer({alpha:!0})).setPixelRatio(window.devicePixelRatio),c.setSize(window.innerWidth,window.innerHeight),e.appendChild(c.domElement);for(var i=2*Math.PI,r=new THREE.SpriteCanvasMaterial({color:10263708,program:function(e){e.beginPath(),e.arc(0,0,.5,0,i,!0),e.fill()}}),n=new THREE.Geometry,o=0;o<100;o++)(t=new THREE.Sprite(r)).position.x=2*Math.random()-1,t.position.y=2*Math.random()-1,t.position.z=2*Math.random()-1,t.position.normalize(),t.position.multiplyScalar(10*Math.random()+450),t.scale.x=t.scale.y=10,l.add(t),n.vertices.push(t.position);var a=new THREE.Line(n,new THREE.LineBasicMaterial({color:10263708,opacity:.5}));l.add(a),document.addEventListener("mousemove",E,!1),document.addEventListener("touchstart",d,!1),document.addEventListener("touchmove",h,!1),window.addEventListener("resize",p,!1)}(),function e(){requestAnimationFrame(e);o()}()}();